{% extends 'tickets/base.html' %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-4">
        {% if movie.poster %}
        <img src="{{ movie.poster.url }}" class="img-fluid rounded movie-poster">
        {% endif %}
    </div>
    <div class="col-md-8">
        <h1>{{ movie.title }}</h1>
        <p class="text-muted">{{ movie.rating }} | {{ movie.formatted_duration }}</p>
        <p>{{ movie.description }}</p>

        <div class="mt-4">
            <h4>Synopsis</h4>
            <div class="synopsis-box p-3 bg-light rounded">
                {{ movie.synopsis|linebreaks }}
            </div>
        </div>
    </div>
</div>

<h3>Available Showtimes</h3>
<div class="list-group">
    {% for showtime in showtimes %}
    <div class="list-group-item">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h5>{{ showtime.theater.name }}</h5>
                <p class="mb-1">{{ showtime.start_time|date:"D, M j, Y" }} at {{ showtime.start_time|time:"g:i A" }}</p>
                <small class="text-muted">Available seats: {{ showtime.available_seats }}</small>
                <div class="mt-2">
                    <small class="fw-bold">Seat Categories:</small>
                    <ul class="list-unstyled">
                        {% for category in showtime.theater.seat_categories.all %}
                        <li>{{ category.name }} - Rs.{{ category.price }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% if showtime.has_passed %}
                <span class="badge showtime-passed">Showtime Passed</span>
            {% elif showtime.is_sold_out %}
                <span class="badge sold-out">Sold Out</span>
            {% else %}
                <a href="{% url 'book_ticket' showtime.id %}" class="btn btn-success">Book Now</a>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <div class="alert alert-warning">No showtimes available</div>
    {% endfor %}
</div>
{% endblock %}